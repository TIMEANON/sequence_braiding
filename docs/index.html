<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Sequence Braiding</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">

  <!-- Libs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script src="https://d3js.org/d3.v4.min.js"></script>

</head>
<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
    <div class="row">
      <div class="twelve columns" style="margin-top: 25%" id='body-container'>
        <h1>Sequence Braiding</h1>
        <p>Temporal event sequence alignment has been used in many domains to visualize nuanced changes and interactions over time.
		Existing approaches align one or two sentinel events.
		Overview tasks require examining all alignments of interest using interaction and time or juxtaposition of many visualizations.
		Furthermore, any event attribute overviews are not closely tied to sequence visualizations.
		We present Sequence Braiding, a novel overview visualization for temporal event sequences and attributes using a layered directed acyclic network.
		Sequence Braiding visually aligns many temporal events and attribute groups simultaneously and supports arbitrary ordering, absence, and duplication of events.
		In a controlled experiment we compare Sequence Braiding and IDMVis on user task completion time, correctness, error, and confidence.
		Our results provide good evidence that users of Sequence Braiding can understand high-level patterns and trends faster and with similar error.</p>

		<svg id='braids-container1'></svg>

		<h2>Usage</h2>

        Initialize the graph with:

        <pre><code> var graph = new SequenceBraiding(data_sequences, path, svgname, opt)</code></pre>

        Sample dataset for three days:

        <pre><code id='dataset-container' contenteditable="true">[
	[
		{"type": "Breakfast",	"level": "very_high"},
		{"type": "Lunch",	"level": "very_high"},
		{"type": "Snack",	"level": "very_high"},
		{"type": "Dinner",	"level": "very_high"}
	],
	[
		{"type": "Breakfast",	"level": "very_high"},
		{"type": "Snack",	"level": "high"},
		{"type": "Dinner",	"level": "very_high"}
	],
	[
		{"type": "Breakfast",	"level": "high"},
		{"type": "Lunch",	"level": "very_high"},
		{"type": "Snack",	"level": "high"},
		{"type": "Dinner",	"level": "high"}
	]
]</code></pre>

        <svg id='braids-container2'></svg>

		<h2>Playground</h2>

        <svg id='braids-container-sandbox'></svg>

        <form style='font-size: small; text-align: center'>
        	<div class="row">
			    <div class="six columns">
			      <label id="numdaysliderlabel" for="numdayslider">Number of days: 25</label>
			      <div width='100%'><input type="range" min="10" max="100" value="25" class="slider" id="numdayslider" style='width: 90%' onmouseup="numdayschanged(this.value)"></div>
			    </div>
			    <div class="six columns">
			    	<label class="example-send-yourself-copy">
				    	<input id="animatecheckbox" type="checkbox" onclick='opt.animate = !opt.animate'>
				    	<span class="label-body">Animate</span>
					</label>
				</div>
			  </div>

			  <div class='row'>
			  	<h5>Colorschemes</h5>
				<button id='buttoncolorscheme0' type="button" style='font-size: large' onclick="colorschemechanged(0)"></button>
				<button id='buttoncolorscheme1' type="button" style='font-size: large' onclick="colorschemechanged(1)"></button>
				<button id='buttoncolorscheme2' type="button" style='font-size: large' onclick="colorschemechanged(2)"></button>
			  </div>

			  <div class='row'>
			  	<h5>Sequence alignment parameters</h5>
			  	<div class='two columns'>
			  		<label id="matchscoresliderlabel" for="bbb">Match score: 10</label>
			      	<div width='100%'><input type="range" min="-20" max="20" value="10" class="slider" id="matchscoreslider" style='width: 90%' onmouseup="matchscorechanged(this.value)"></div>
			  	</div>
			  	<div class='two columns'>
			  		<label id="mismatchscoresliderlabel" for="bbb">Mismatch score: -20</label>
			      	<div width='100%'><input type="range" min="-20" max="20" value="-20" class="slider" id="mismatchscoreslider" style='width: 90%' onmouseup="mismatchscorechanged(this.value)"></div>
			  	</div>
			  	<div class='two columns'>
			  		<label id="begingappenaltysliderlabel" for="bbb">Begin gap penalty: 2</label>
			      	<div width='100%'><input type="range" min="-20" max="20" value="2" class="slider" id="begingappenaltyslider" style='width: 90%' onmouseup="begingappenaltychanged(this.value)"></div>
			  	</div>
			  	<div class='two columns'>
			  		<label id="gappenaltysliderlabel" for="bbb">Gap penalty: 1</label>
			      	<div width='100%'><input type="range" min="-20" max="20" value="1" class="slider" id="gappenaltyslider" style='width: 90%' onmouseup="gappenaltychanged(this.value)"></div>
			  	</div>
			  	<div class='two columns'>
			  		<label id="endgappenaltysliderlabel" for="bbb">End gap penalty: 2</label>
			      	<div width='100%'><input type="range" min="-20" max="20" value="25" class="slider" id="endgappenaltyslider" style='width: 90%' onmouseup="endgappenaltychanged(this.value)"></div>
			  	</div>
			  </div>
        </form>

      </div>
    </div>
  </div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>

<script src='../lib/align_pair_quad.js'></script>
<script src='../lib/pairwise_alignment_dna.js'></script>
<script src='../js/util.js'></script>
<script src='../js/newtest.js'></script>
<script src='../js/main.js'></script>

<script>

	graph1 = init_sankey(10, 'braids-container1')

	//graph2 = init_sankey(3, 'braids-container2')

	graph_sandbox = init_sankey(25, 'braids-container-sandbox')

	document.getElementById("numdayslider").value = 25
	document.getElementById("matchscoreslider").value = 10
	document.getElementById("mismatchscoreslider").value = -20
	document.getElementById("begingappenaltyslider").value = 2
	document.getElementById("gappenaltyslider").value = 1
	document.getElementById("endgappenaltyslider").value = 2

	document.getElementById('animatecheckbox').checked = false

	colorschemes = [
		["#fff", "#E32551", "#F07C19", "#029DAF", "#FFC219", "#cd5b43", "#fff"],
		["#fff", "#C44D58", "#FF6B6B", "#C7F464", "#4ECDC4", "#556270", "#fff"],
		["#fff", "#B05574", "#F87E7B", "#FAB87F", "#DCD1B4", "#5E9FA3", "#fff"]
	]

	for (var j in colorschemes){
		document.getElementById('buttoncolorscheme'+j).innerHTML = ''
		for (var i in colorschemes[j]) 
			document.getElementById('buttoncolorscheme'+j).innerHTML += '<span style="color:'+colorschemes[j][i]+'">●</span>'
	}

	function numdayschanged(val){
		document.getElementById('braids-container-sandbox').innerHTML = ''
		document.getElementById("numdaysliderlabel").innerHTML = 'Number of days: ' + val
		opt.numDays = val
		graph_sandbox = init_sankey(val)
	}

	function colorschemechanged(val){
		document.getElementById('braids-container-sandbox').innerHTML = ''
		opt.colorscheme = colorschemes[val]
		graph_sandbox = init_sankey()
	}

	function matchscorechanged(val){
		opt.MATCH_SCORE = val
		document.getElementById("matchscoresliderlabel").innerHTML = 'Match score: ' + val
		document.getElementById('braids-container-sandbox').innerHTML = ''
		graph_sandbox = init_sankey()
	}

	function mismatchscorechanged(val){
		opt.MISMATCH_SCORE = val
		document.getElementById("mismatchscoresliderlabel").innerHTML = 'Mismatch score: ' + val
		document.getElementById('braids-container-sandbox').innerHTML = ''
		graph_sandbox = init_sankey()
	}

	function begingappenaltychanged(val){
		opt.BEGIN_GAP_PENALTY = val
		document.getElementById("begingappenaltysliderlabel").innerHTML = 'Begin gap penalty: ' + val
		document.getElementById('braids-container-sandbox').innerHTML = ''
		graph_sandbox = init_sankey()
	}

	function gappenaltychanged(val){
		opt.GAP_PENALTY = val
		document.getElementById("gappenaltysliderlabel").innerHTML = 'Gap penalty: ' + val
		document.getElementById('braids-container-sandbox').innerHTML = ''
		graph_sandbox = init_sankey()
	}

	function endgappenaltychanged(val){
		opt.END_GAP_PENALTY = val
		document.getElementById("endgappenaltysliderlabel").innerHTML = 'End gap penalty: ' + val
		document.getElementById('braids-container-sandbox').innerHTML = ''
		graph_sandbox = init_sankey()
	}

</script>

<script>
	content = document.getElementById('dataset-container').textContent
	parsedjson = JSON.parse(content)
	parsedjson.forEach(a => a.forEach(b => b.seq_index = parsedjson.indexOf(a)))
	path = find_path(parsedjson)
	d3.select('#braids-container2')
            .attr('width', '100%')
            .attr('height', '300px')
	newgraph = new SequenceBraiding(parsedjson, path, 'braids-container2', opt)
	document.getElementById('dataset-container').addEventListener('input', function() {
	    document.getElementById('braids-container2').innerHTML = ''
		content = document.getElementById('dataset-container').textContent
		parsedjson = JSON.parse(content)
		parsedjson.forEach(a => a.forEach(b => b.seq_index = parsedjson.indexOf(a)))
		path = find_path(parsedjson)
		d3.select('#braids-container2')
	            .attr('width', '100%')
	            .attr('height', '300px')
		newgraph = new SequenceBraiding(parsedjson, path, 'braids-container2', opt)
	});
	
</script>

</html>
